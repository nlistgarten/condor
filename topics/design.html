<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="prev" title="Topics" href="index.html" />

    <!-- Generated with Sphinx 8.2.0 and Furo 2024.08.06 -->
        <title>Condor Design - Condor 0.1.dev1+g166ba2c documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/overrides.css?v=5914a474" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Condor 0.1.dev1+g166ba2c documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Condor 0.1.dev1+g166ba2c documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/sellar.html">Introduction to Condor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/polar_transform.html">Polar Transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/trajectory.html">Working with trajectories</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../howto/index.html">How-To Guide</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of How-To Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../howto/table_basics.html">Tabular Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/parallel_processing.html">Parallel Processing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">Condor API</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Condor API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/contrib.html">Contrib Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/fields.html">Fields and Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/implementations.html">Implementations</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Topics</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Topics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Condor Design</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/topics/design.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="condor-design">
<h1>Condor Design<a class="headerlink" href="#condor-design" title="Link to this heading">¶</a></h1>
<section id="overall-goals-and-api">
<h2>Overall goals and API<a class="headerlink" href="#overall-goals-and-api" title="Link to this heading">¶</a></h2>
<p>Condor is a new mathematical modeling framework for Python, developed at NASA’s Ames Research Center.
Initial development began in April 2023 to address modeling challenges for aircraft synthesis and robust
orbital trajectory design.  Condor emphasizes modern approaches from the scientific python community, and
leverages many open-source software packages to expedite development and ensure robust and efficient
run-time.</p>
<p>The goal is for Condor to help evaluate numerical models and then get out of the way. One key aspect to
achieve this goal was to create an API that looked as much like the mathematical description as
possible with as little distraction from programming cruft as possible.  For example, Sellar
introduces an arbitrary system of algebraic equations to represent coupling in multi-disciplinary analysis,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
y_{1}&amp;=x_{0}^{2}+x_{1}+x_{2}-0.2\,y_{2} \\
y_{2}&amp;=\sqrt{y_{1}}+x_{0}+x_{1}
\end{align}\end{split}\]</div>
</div>
<p>should be writable as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y1</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">y2</span>
<span class="n">y2</span> <span class="o">==</span> <span class="n">y1</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Of course, in both the mathematic and programmatic description, the source of each
symbol must be defined. In an engineering memo, we might say “where <span class="math notranslate nohighlight">\(y_1,y_2\)</span>
are the variables to solve and <span class="math notranslate nohighlight">\(x \in \mathbb{R}^3\)</span> parameterizes the system of
equations,” which suggests the API for an algebraic system of equations as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">condor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">co</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Coupling</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">AlgebraicSystem</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">variable</span><span class="p">(</span><span class="n">initializer</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">variable</span><span class="p">(</span><span class="n">initializer</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>

    <span class="n">residual</span><span class="p">(</span><span class="n">y1</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">residual</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">y1</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>which can be evaluated by instantiating the model with numerical values for hte
parameter, which <em>binds</em> the result from the iterative solver to the named <em>element</em> and
<em>field</em> attributes on the instance,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coupling</span> <span class="o">=</span> <span class="n">Coupling</span><span class="p">([</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1"># evaluate the model numerically</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coupling</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span> <span class="n">coupling</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span> <span class="c1"># individual elements are bound numerically</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coupling</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span> <span class="c1"># fields are bound as a dataclass</span>
</pre></div>
</div>
<p>This pythonic datastructure allows Condor to be integrated into larger analysis workflows
with as little Condor-specific coding as possible.</p>
<p>Condor uses metaprogramming to to turn the class <em>declaration</em> mechanism into a
blackboard-like environment to achieve the desired API. This approach helps us see
these mathematical models as datastructures that can then be transformed as needed to
automate the process that is typically performed manually for defining and evaluating
mathematical models in engineering analysis,</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/math-model-process.png"><img alt="../_images/math-model-process.png" src="../_images/math-model-process.png" style="width: 100%;" />
</a>
</figure>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">¶</a></h2>
<p>We followed modern pythonic best-practices and patterns to settle on a multi-layered
architecture like the Model-View-Controller paradigm in web development. The
three key components of the architecture are:</p>
<ul class="simple">
<li><p>The model layer, which provides an API for users to write their model. Condor models
are ultimately a data structure which represents the represents the user’s
mathematical intent for the model.</p></li>
<li><p>The backend layer provides a consistent interface to a third party <em>Computational
Engine</em>, a symbolic-computational library which provides symbolic representation of
<em>elements</em> and <em>operations</em> with awareness for basic differential calculus. The goal
for the backend is provide a thin wrapper with a consistent interface so the
computational engine implementation could be swapped out. Currently, we ship with
CasADi as the only engine, although we hope to demonstrate a backend module for an
alternate backend in the future.</p></li>
<li><p>The implementation layer is the glue code that operates on the model data structure,
using the backend to form the numerical functions needed to call the third-party
solvers which implement the nuemrical algorithms of interest. The implementation
layer then calls the solver and binds the results to the model instance.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/architecture.png"><img alt="../_images/architecture.png" src="../_images/architecture.png" style="width: 50%;" />
</a>
</figure>
</section>
<section id="the-model-layer">
<h2>The Model Layer<a class="headerlink" href="#the-model-layer" title="Link to this heading">¶</a></h2>
<p>Each user model is declared as a subclass of a <em>Model Template</em>, a <code class="docutils literal notranslate"><span class="pre">class</span></code> with a
<code class="docutils literal notranslate"><span class="pre">ModelType</span></code> metaclass, which defines the <em>fields</em> from which <em>elements</em> are drawn to
define the model. Condor currently ships with 5 model templates:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>built-in template</p></th>
<th class="head" colspan="3"><p>fields</p></th>
</tr>
<tr class="row-even"><th class="head"><p>input</p></th>
<th class="head"><p>internal</p></th>
<th class="head"><p>output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ExplicitSystem</span></code></p></td>
<td><ul class="simple">
<li><p>input</p></li>
</ul>
</td>
<td></td>
<td><ul class="simple">
<li><p>output</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TableLookup</span></code></p></td>
<td><ul class="simple">
<li><p>input</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>input_data</p></li>
<li><p>output_data</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>output</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AlgebraicSystem</span></code></p></td>
<td><ul class="simple">
<li><p>parameter</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>residual</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>variable</p></li>
<li><p>output</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TrajectoryAnalysis</span></code></p></td>
<td><ul class="simple">
<li><p>parameter</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>state</p></li>
<li><p>modal.action</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>trajectory_output</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">OptimizationProblem</span></code></p></td>
<td><ul class="simple">
<li><p>parameter</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>objective</p></li>
<li><p>constraint</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>variable</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<p>Models can be used recursively, building up more sophisticated models by <em>embedding</em>
models within another. However, system encapsolation is enforced so only elements from input and
output fields are accessible after the model has been defined. For example, we may
wish to optimize Sellar’s algebraic system of equations. Mathematically, we can define
the optimization as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\operatorname*{minimize}_{x \in \mathbb{R}^3} &amp;  &amp;  &amp; x_{2}^{2}+x_{1}+y_{1}+e^{-y_{2}} \\
\text{subject to} &amp;  &amp;  &amp; 3.16\le y_{1}\\
 &amp;  &amp;  &amp; y_{2}\le24.0
\end{aligned}\end{split}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(y_1\)</span> and <span class="math notranslate nohighlight">\(y_2\)</span> are the solution to the system of algebraic
equations described above. In condor, we can write this as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">condor</span><span class="w"> </span><span class="kn">import</span> <span class="n">operators</span> <span class="k">as</span> <span class="n">ops</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Sellar</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">OptimizationProblem</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">lower_bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">coupling</span> <span class="o">=</span> <span class="n">Coupling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">coupling</span>

    <span class="n">objective</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ops</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span>
    <span class="n">constraint</span><span class="p">(</span><span class="n">y1</span> <span class="o">&gt;</span> <span class="mf">3.16</span><span class="p">)</span>
    <span class="n">constraint</span><span class="p">(</span><span class="mf">24.</span> <span class="o">&gt;</span> <span class="n">y2</span><span class="p">)</span>
</pre></div>
</div>
<p>As with the system of algebraic equations, we can numerically solve this optimization
problem by providing an initial value for the variables and instantiating the model.
The resulting object will have a dot-able data structure with the bound results,
including the embedded <code class="docutils literal notranslate"><span class="pre">Coupling</span></code> model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Sellar</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sellar</span> <span class="o">=</span> <span class="n">Sellar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;objective value:&quot;</span><span class="p">,</span> <span class="n">sellar</span><span class="o">.</span><span class="n">objective</span><span class="p">)</span> <span class="c1"># scalar value</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sellar</span><span class="o">.</span><span class="n">constraint</span><span class="p">)</span> <span class="c1"># field</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sellar</span><span class="o">.</span><span class="n">coupling</span><span class="o">.</span><span class="n">y1</span><span class="p">)</span> <span class="c1"># embedded-model element</span>
</pre></div>
</div>
<p>The built-in model types provide a useful library to build small or one-off modeling capabilities.
We also ensured that there were good mechanisms for customizing models and creating new models to
address repeat and sophisticated modeling tasks.</p>
<section id="fields-and-elements">
<h3>Fields and Elements<a class="headerlink" href="#fields-and-elements" title="Link to this heading">¶</a></h3>
<p>Fields contain the elements. Can be</p>
</section>
<section id="metaprogramming-class-declaration">
<h3>Metaprogramming class declaration<a class="headerlink" href="#metaprogramming-class-declaration" title="Link to this heading">¶</a></h3>
<p>Ionel provides a nice overview of Python3 process for class declaration
and object instantiation. Relevant for us is the following call-order. For
class declaration,</p>
<ol class="arabic simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Metaclass.__prepare__()</span></code> creates a class dictionary at the entry
of the <code class="docutils literal notranslate"><span class="pre">class</span></code> declaration.</p></li>
<li><p>Each assignment within the class declaration uses the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__setitem__()</span></code> of the class dictionary</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">Metaclass.__new__()</span></code> is passed the (filled) class dictionary and
creates the class via <code class="xref py py-meth docutils literal notranslate"><span class="pre">type.__call__()</span></code>. Note that
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Metaclass.__init__()</span></code> is also called after this but is not as
useful because the <code class="code docutils literal notranslate"><span class="pre">class</span></code> is already fully constructed by this point;
the <code class="code docutils literal notranslate"><span class="pre">__init__</span></code> can only be used to organize post-processing.</p></li>
</ol>
<p>Is there any shared flow between a Template and Model? Yes, show Template first then Model.</p>
<section id="modeltemplate-declaration">
<h4><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelTemplate</span></code> declaration<a class="headerlink" href="#modeltemplate-declaration" title="Link to this heading">¶</a></h4>
<p>Annotated flow of how a <code class="xref py py-class docutils literal notranslate"><span class="pre">ModelTemplate</span></code> is created</p>
</section>
<section id="model-declaration">
<h4><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> declaration<a class="headerlink" href="#model-declaration" title="Link to this heading">¶</a></h4>
<p>Annotated flow of how a <code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> is created –</p>
</section>
</section>
<section id="calling-and-binding">
<h3>Calling and binding<a class="headerlink" href="#calling-and-binding" title="Link to this heading">¶</a></h3>
<p>the <code class="code docutils literal notranslate"><span class="pre">__class__</span></code> is <code class="xref py py-meth docutils literal notranslate"><span class="pre">__call__()</span></code>ed which calls the <code class="xref py py-meth docutils literal notranslate"><span class="pre">__new__()</span></code> which creates
the <code class="code docutils literal notranslate"><span class="pre">self</span></code> object which is then passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>.</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">condor.Model.__init__()</span></code> parses the positional and keyword arguments to bind
the values for the input field(s). Then the</p>
</section>
</section>
<section id="the-implementation-layer">
<h2>The implementation layer<a class="headerlink" href="#the-implementation-layer" title="Link to this heading">¶</a></h2>
<p>The implementation layer is responsible for using the backend to create
the numerical functions needed to evaluate model and call any solvers as
needed.</p>
<p>The embedded <code class="xref py py-class docutils literal notranslate"><span class="pre">Options</span></code> class inside a model provides a name-space.
Attributes without a leading underscore are placed into a <code class="docutils literal notranslate"><span class="pre">dict</span></code> for
the keyword arguments to the implementation’s <code class="xref py py-func docutils literal notranslate"><span class="pre">construct()</span></code>
method. Special behavior for <code class="docutils literal notranslate"><span class="pre">_implementation</span></code> and …</p>
<p>Solver options can be passed from throught he Options attribute. Ultimately it is the
implementations job to parse the Options, but except where different solvers for the
same model-type conflict the intention is to make the argument manipulation at the
implementation layer as thin as possible.</p>
<p>the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Options</span></code> can be considered model inputs that make sense to have a default. They
are also intended to be inputs that don’t define the mathematical meaning of the model.</p>
</section>
<section id="the-backend">
<h2>The backend<a class="headerlink" href="#the-backend" title="Link to this heading">¶</a></h2>
<p>The backend layer provides a common interface to potential
“computational engine” libraries. Currently, we support only the
CasADi engine. Condor uses a “shim” so that the capability needed by the computational
engine can be accessed from the same import within the library. For each engine, a
<code class="xref py py-mod docutils literal notranslate"><span class="pre">backends</span></code> module must be provided to adapt the engine to a common API.</p>
</section>
<section id="using-condor-for-a-tool-or-library">
<h2>Using Condor for a “tool” or library<a class="headerlink" href="#using-condor-for-a-tool-or-library" title="Link to this heading">¶</a></h2>
<p>Useful engineering analysis tools can be built as a Python library simply by
constructing the desired model witht he <code class="xref py py-mod docutils literal notranslate"><span class="pre">contrib</span></code> models. Since the Model is
defined by constructing a <code class="code docutils literal notranslate"><span class="pre">class</span></code>, Python class variable scoping prevents the dynamic
definition of models inside a factory function. To get around this, a “configuration” pattern
was defined with a <code class="xref py py-meth docutils literal notranslate"><span class="pre">dynamic_link()</span></code> helper. The Systems Analysis Office at NASA’s Ames
Research Center has used this approach to build an aircraft synthesis and analysis tool using
Condor.</p>
<p>More recently, the metaprogramming back-bone of Condor was refactored to facilitate
the customization of symbolic processing to facilitate the creation of custom
<code class="xref py py-class docutils literal notranslate"><span class="pre">ModelTemplate</span></code>s. To create a new type of analysis tool, we now recommend leveraging
this capability. A design process might include:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Identify the data required to specify the analysis, and identify the <code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code> (or
create a custom <code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code>) that would be appropriate for holding that data</p></li>
<li><p>Identify (or create) what solver and implementation is needed, including a mapping
from the new type of Model to the an existing model or solver.</p></li>
<li><p>Implement a <code class="xref py py-meth docutils literal notranslate"><span class="pre">process_placeholder()</span></code> for processing the models data so the implementation
can call the solver.</p></li>
</ol>
</div></blockquote>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Topics</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Benjamin W. L. Margolis
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Condor Design</a><ul>
<li><a class="reference internal" href="#overall-goals-and-api">Overall goals and API</a></li>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
<li><a class="reference internal" href="#the-model-layer">The Model Layer</a><ul>
<li><a class="reference internal" href="#fields-and-elements">Fields and Elements</a></li>
<li><a class="reference internal" href="#metaprogramming-class-declaration">Metaprogramming class declaration</a><ul>
<li><a class="reference internal" href="#modeltemplate-declaration"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelTemplate</span></code> declaration</a></li>
<li><a class="reference internal" href="#model-declaration"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> declaration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calling-and-binding">Calling and binding</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-implementation-layer">The implementation layer</a></li>
<li><a class="reference internal" href="#the-backend">The backend</a></li>
<li><a class="reference internal" href="#using-condor-for-a-tool-or-library">Using Condor for a “tool” or library</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=420e6901"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>